#!/bin/bash
catkin run_tests aerial_autonomy > /dev/null
error=$?
if [ $error -ne 0 ]
then
  echo "Catkin BUILD Failed"
  exit 1
fi
TEST_COVERAGE_DIR=${CMAKE_CURRENT_SOURCE_DIR}/test_coverage_info
if [ ! -d "$TEST_COVERAGE_DIR" ]; then
  mkdir $TEST_COVERAGE_DIR
fi
lcov --capture --directory  ${CMAKE_CURRENT_BINARY_DIR} --base-directory ${CMAKE_CURRENT_SOURCE_DIR} --output-file $TEST_COVERAGE_DIR/test_coverage.info --no-external > /dev/null 2>/dev/null
lcov  -r $TEST_COVERAGE_DIR/test_coverage.info ${CMAKE_CURRENT_BINARY_DIR}/\*.pb.\* --output-file $TEST_COVERAGE_DIR/test_coverage.info > /dev/null
genhtml $TEST_COVERAGE_DIR/test_coverage.info --output-directory $TEST_COVERAGE_DIR > /dev/null
